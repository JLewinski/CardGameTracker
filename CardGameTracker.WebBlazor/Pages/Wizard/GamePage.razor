@page "/wizard/game/{id:guid}"

@if (isLoading)
{
    <h1>Loading...</h1>
}
else if (string.IsNullOrEmpty(Game.FirstDealer))
{
    <h1>Select Dealer</h1>
    <InputSelect @bind-Value=firstDealerText class="form-control">
        <option value="@string.Empty">Select Dealer</option>
        @foreach (var player in Game.Players)
        {
            <option value="@player.Name">@player.Name</option>
        }
    </InputSelect>
    <button @onclick="SetFirstDealer" class="btn btn-primary mt-2">Set Dealer</button>
}
else
{
    <div class="container">
        <div class="row">
            <div class="col-auto">
                <h1 class="text-center">Score Board</h1>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var player in Game.Players)
                        {
                            <tr>
                                <td>@player.Name</td>
                                <td>@Game.GetTotalScore(player)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="col gx-5">
                <h1 class="text-center">Round @currentRound / @Game.NumTotalRounds</h1>
                <div>
                    <InputSelect @bind-Value="currentSuite" class="form-control">
                        <option value="@string.Empty">Select Suite</option>
                        <option value="Hearts">Hearts</option>
                        <option value="Spades">Spades</option>
                        <option value="Diamonds">Diamonds</option>
                        <option value="Clubs">Clubs</option>
                    </InputSelect>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th></th>
                            <th>Bid</th>
                            <th>Tricks</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var player in Game.Players)
                        {
                            <tr>
                                <td>@player.Name</td>
                                <td>
                                    @if (currentDealer == player.Name)
                                    {
                                        <span class="badge bg-primary">Dealer</span>
                                    }
                                </td>
                                <td>
                                    <InputNumber @bind-Value="Game.Rounds[currentRound - 1].Scores[player.Name].Bid"
                                        class="form-control" tabindex="1" />
                                </td>
                                <td>
                                    <InputNumber @bind-Value="Game.Rounds[currentRound - 1].Scores[player.Name].TricksTaken"
                                        class="form-control" tabindex="2" />
                                </td>
                                <td>@Game.Rounds[currentRound - 1].Scores[player.Name].CalculatedScore</td>
                            </tr>
                        }
                        <tr>
                            <td></td>
                            <td></td>
                            <td><small>@Game.Rounds[currentRound - 1].Scores.Sum(x => x.Value.Bid)</small></td>
                            <td><small class="@(Game.HasValidTricks(currentRound) ? "text-success" : "text-danger")">@Game.Rounds[currentRound - 1].Scores.Sum(x => x.Value.TricksTaken)</small></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="col"></div>
                    <div class="col-auto">
                        @if (currentRound > 1)
                        {
                            <button @onclick="PreviousRound" class="btn btn-primary m-2">Previous Round</button>
                        }
                        @if (Game.IsValidRound(currentRound))
                        {
                            <button @onclick="NextRound" class="btn btn-primary">Next Round</button>
                        }
                    </div>
                    <div class="col"></div>
                </div>
            </div>
        </div>
    </div>
}
